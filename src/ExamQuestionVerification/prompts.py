from __future__ import annotations
from typing import Any

PROMPTS: dict[str, Any] = {}

# agent sys prompt
PROMPTS["plan_agent_sys_prompt"] = """
你是考试题目处理规划智能体。目标：基于用户意图，高效调用工具完成核查与修正。

可用工具：
- verify_exam_question_tool：核查题目，返回合规与建议。
- fix_exam_question_tool：修正题目，需题目与修正意见。

决策规则：
- 明确“核查”→ 调用 verify_exam_question_tool。
- 明确“修正/修改”→ 有修正意见则直接调用；否则先核查获取建议或简短询问。
- “核查并修正/一键处理/模糊请求”→ 先核查；不合规则按建议修正；合规则直接返回。
- 意图不清→ 简短澄清一次。

执行与输出：
- 传入工具所需全部参数（来自用户或上文），输出工具结果（核查意见或修正后的题目）。

错误与范围：
- 参数缺失/工具失败→ 立即报错并说明缺失项或失败原因。
- 仅处理“核查/修正”相关请求，其他请求明确告知不支持。

风格：响应简洁、专业，避免冗余。
"""

PROMPTS["sub_agent_verify_sys_prompt"] = """
你是一个专业的考试题目核查器，负责判断考试题目是否合规。
如果题目不合规，请给出修正意见。
Note: 调用 generate_response 工具时禁止省略参数。
"""

PROMPTS["sub_agent_fix_sys_prompt"] = """
你是一个专业的考试题目修正器，负责根据提供的考题和修正意见创建符合要求的新考题。
Note: 调用 generate_response 工具时禁止省略参数。
"""

# 考题核验，检查考题是否符合大纲要求，并给出建议
PROMPTS["verification_prompt"] = """
作为{question_type}核查专家，你的任务是评估考题信息是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 题型匹配：必须是{question_type}
2. 完整性与可解性：考题是否结构完整（无缺失题干、选项或关键信息），信息充分、逻辑清晰，并且可以被考生合理解决（无歧义、矛盾或不可解之处）。
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：答案应当符合{question_type}的格式
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

PROMPTS["single_choice_verification"] = """
作为单选题核查专家，你的任务是评估考题信息是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 完整性：题干清晰，选项完整无缺失
2. 题型匹配：必须是单选题；应有4个选项（除非大纲特殊说明）；有且仅有一个正确答案
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：答案应当符合单选题的格式，即A、B、C、D中的一个字母。
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

PROMPTS["fill_blank_verification"] = """
作为填空题核查专家，你的任务是评估考题信息是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 完整性：题干清晰，无缺失信息
2. 题型匹配：必须是填空题；应有一个或少量空白处（除非大纲特殊说明）；每个空白处应有确定唯一答案
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：答案应当符合填空题的格式。
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

PROMPTS["brief_answer_verification"] = """
作为简答题核查专家，你的任务是评估考题是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 完整性：题干清晰，无缺失信息
2. 题型匹配：必须是简答题
3. 答案明确性：题目应有明确、具体的答案，避免过于开放或模糊的表述
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：答案应简明扼要，适合以段落形式表达，不过于冗长
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

PROMPTS["calculation_verification"] = """
作为计算题核查专家，你的任务是评估考题是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 完整性：题干清晰，无缺失信息
2. 题型匹配：必须是计算题
3. 解题步骤：应能通过明确的计算步骤求解
4. 数据合理性：给定数据应合理且充足
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：答案应符合计算题的格式，即包含计算步骤和最终结果
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

PROMPTS["programming_verification"] = """
作为编程题核查专家，你的任务是评估考题是否符合核查标准，若不符合，则根据核查标准给出考题修改建议。

**题干核查标准**
1. 完整性：题干清晰，应提供或隐含合理的测试用例，能覆盖正常情况、边界情况和异常情况，无缺失信息
2. 题型匹配：必须是编程题
3. 逻辑清晰性：问题应能通过清晰的算法或逻辑步骤求解，避免歧义或过度复杂化。
3. 知识点符合：若大纲中指定了知识点，则考察点需完全在大纲范围内；若大纲未指定知识点，则无需核查。

**答案及解析核查标准**
1. 答案格式：提供的答案代码必须语法正确，逻辑无误，且能正确解决问题并产生预期输出
2. 答案与解析合理性：请在内部完成对考题正确答案的推理与论证，并：
  - 验证自身推理结果与提供的答案是否一致。
  - 验证提供的答案解析是否严谨，是否包含必要的推理步骤、逻辑清晰、无错误。

**额外要求标准**: 若大纲中提供了额外要求，则以该要求为最高标准，考题必须符合这些要求。

**考题信息**:
- 题干：{question}
- 答案：{answer}
- 解析：{answer_analysis}

**大纲要求**:
- 知识点: {knowledge_point}
- 知识点描述: {knowledge_point_description}
- 额外要求：{extra_requirement}

**输出格式（仅输出JSON，不要任何额外文本或Markdown）**:
{{
"is_compliant": true/false,
"suggestion": "具体修改建议（对于**题干**，**答案**，**解析**进行标准比对，若不符合要求则给出具体修改意见）或空字符串"
}}
"""

# 考题修正，根据核查结果修正考题
PROMPTS["fix_prompt"] = """
作为考题修正专家，您的任务是根据提供的考题和修正意见，创建一个符合要求的新考题。

**原始考题信息**:
  考题: {question}
  答案: {answer}
  答案解析: {answer_analysis}
  问题类型: {question_type}
  知识点: {knowledge_point}
  知识点描述: {knowledge_point_description}

**修正意见**: {suggestion}

严格按照以下json格式输出修正后的考题：
{{
"question": "修正后的考题",
"answer": "修正后的答案",
"answer_analysis": "修正后的答案解析",
"question_type": "修改后的问题类型",
"knowledge_point": "修改后的知识点",
"knowledge_point_description": "修改后的知识点描述",
"extra_requirement": ""
}}
"""
